<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/pupil/dashboard"></ion-back-button>
    </ion-buttons>
    <ion-title>Treino de Natação</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content>
  <div class="workout-container">
    <!-- Cabeçalho do treino -->
    <ion-card class="header-card">
      <ion-card-header>
        <ion-card-title>{{ workout.name }}</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="personal-info">
          <ion-icon name="person-outline"></ion-icon>
          <span>Personal: {{ workout.personalName }}</span>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Temporizador principal -->
    <ion-card class="timer-card">
      <ion-card-header>
        <ion-card-title>Tempo de Treino</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="timer-display">{{ formatTime(mainTimer) }}</div>
        <div class="timer-controls">
          <ion-button color="light" (click)="resetMainTimer()">
            <ion-icon name="refresh-outline"></ion-icon>
          </ion-button>
          <ion-button [color]="isMainTimerRunning ? 'danger' : 'primary'" (click)="toggleMainTimer()">
            <ion-icon [name]="isMainTimerRunning ? 'pause-outline' : 'play-outline'"></ion-icon>
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Progresso do treino -->
    <ion-card class="progress-card">
      <ion-card-header>
        <ion-card-title>Progresso</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="completion">
          <span>Completado</span>
          <span>{{ getCompletionPercentage() }}%</span>
        </div>
        <ion-progress-bar [value]="getCompletionPercentage() / 100"></ion-progress-bar>
        <div class="stats">
          <div class="stat">
            <div class="number">{{ completedSets }}/{{ workout.sets.length }}</div>
            <div class="label">Séries</div>
          </div>
          <div class="stat">
            <div class="number">{{ completedDistance }}m</div>
            <div class="label">Distância</div>
          </div>
          <div class="stat">
            <div class="number">{{ workout.totalDistance - completedDistance }}m</div>
            <div class="label">Restante</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Série atual -->
    <ion-card class="set-card" *ngIf="currentSetIndex < workout.sets.length && !isRestTimerActive">
      <ion-card-header>
        <ion-card-title>Exercício Atual</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="exercise-info">
          <h2>{{ workout.sets[currentSetIndex].exerciseName }}</h2>

          <div class="exercise-detail">
            <div class="label">Repetição</div>
            <div class="value">{{ currentRepetition }}/{{ workout.sets[currentSetIndex].repetitions }}</div>
          </div>

          <div class="exercise-detail">
            <div class="label">Distância</div>
            <div class="value">{{ workout.sets[currentSetIndex].distance }}m</div>
          </div>

          <div class="exercise-detail" *ngIf="workout.sets[currentSetIndex].notes">
            <div class="label">Observações</div>
            <div class="value">{{ workout.sets[currentSetIndex].notes }}</div>
          </div>
        </div>

        <ion-button expand="block" color="primary" class="lap-button" (click)="recordLap()">
          <ion-icon name="stopwatch-outline" slot="start"></ion-icon>
          Registrar Volta
        </ion-button>

        <ion-button expand="block" color="medium" class="lap-button" (click)="skipCurrentSet()">
          <ion-icon name="play-skip-forward-outline" slot="start"></ion-icon>
          Pular Série
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Temporizador de descanso -->
    <ion-card class="rest-card" *ngIf="isRestTimerActive">
      <ion-card-header>
        <ion-card-title>Descanso</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="rest-timer">{{ formatTime(restTimer) }}</div>
        <ion-progress-bar [value]="restTimer / initialRestTime" class="rest-progress"></ion-progress-bar>
        <div class="rest-message">
          Próxima: {{ workout.sets[currentSetIndex].exerciseName }} - Repetição {{ currentRepetition }}
        </div>
        <ion-button expand="block" color="primary" class="skip-button" (click)="skipRest()">
          <ion-icon name="play-skip-forward-outline" slot="start"></ion-icon>
          Pular Descanso
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Treino completo -->
    <ion-card class="complete-card" *ngIf="currentSetIndex >= workout.sets.length">
      <ion-card-header>
        <ion-card-title>Treino Concluído!</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="complete-message">
          Você completou todas as séries do treino. Parabéns!
        </div>
        <ion-button expand="block" color="success" class="complete-button" (click)="finishWorkout()">
          <ion-icon name="checkmark-circle-outline" slot="start"></ion-icon>
          Finalizar Treino
        </ion-button>
      </ion-card-content>
    </ion-card>

    <!-- Histórico de voltas -->
    <ion-card class="laps-card" *ngIf="laps.length > 0">
      <ion-card-header>
        <ion-card-title>Voltas Registradas</ion-card-title>
      </ion-card-header>
      <ion-card-content>
        <div class="laps-list">
          <div class="lap-item" *ngFor="let lap of laps.slice().reverse()">
            <div class="lap-info">
              <div class="exercise">{{ lap.exerciseName }}</div>
              <div class="details">Série {{ lap.setIndex + 1 }}, Repetição {{ lap.repetition }}, {{ lap.distance }}m</div>
            </div>
            <div class="lap-time">{{ formatTime(lap.time) }}</div>
          </div>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- Botão de finalização -->
    <ion-button expand="block" color="danger" (click)="showFinishConfirm()" *ngIf="currentSetIndex < workout.sets.length">
      <ion-icon name="flag-outline" slot="start"></ion-icon>
      Finalizar Treino
    </ion-button>
  </div>
</ion-content>
